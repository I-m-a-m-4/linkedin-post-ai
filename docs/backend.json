
{
  "entities": {
    "Admin": {
        "title": "Admin",
        "description": "Represents a user with administrative privileges.",
        "type": "object",
        "properties": {
            "uid": {
                "type": "string",
                "description": "The unique user ID from Firebase Authentication."
            },
            "addedAt": {
                "type": "string",
                "format": "date-time",
                "description": "Timestamp when the user was made an admin."
            }
        },
        "required": ["uid"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LinkedIn Post Formatter AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username or handle."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profileName": {
          "type": "string",
          "description": "The user's Profile Name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "UserMetadata": {
        "title": "User Metadata",
        "description": "Stores metadata for a user, like their credit balance.",
        "type": "object",
        "properties": {
            "userId": {
                "type": "string",
                "description": "The ID of the user this metadata belongs to."
            },
            "credits": {
                "type": "number",
                "description": "The number of available formatting credits."
            },
            "createdAt": {
                "type": "string",
                "format": "date-time",
                "description": "Timestamp when the metadata was first created."
            }
        },
        "required": ["userId", "credits"]
    },
    "UsageHistory": {
        "title": "Usage History",
        "description": "Logs an instance of a user spending a credit.",
        "type": "object",
        "properties": {
            "action": {
                "type": "string",
                "description": "The action that was performed (e.g., 'autoFormat')."
            },
            "timestamp": {
                "type": "string",
                "format": "date-time"
            },
            "creditsSpent": {
                "type": "number"
            }
        },
        "required": ["action", "timestamp", "creditsSpent"]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a LinkedIn post formatted by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Post entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created the post. (Relationship: User 1:N Post)"
        },
        "originalText": {
          "type": "string",
          "description": "The original, unformatted text of the post."
        },
        "formattedText": {
          "type": "string",
          "description": "The AI-formatted text of the post."
        },
        "formattingOptions": {
          "type": "string",
          "description": "Options used to format text",
          "format": "string"
        },
        "previewHtml": {
          "type": "string",
          "description": "HTML code for the live LinkedIn preview."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        },
        "refinementHistoryIds": {
          "type": "array",
          "description": "A list of refinements IDs",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "originalText",
        "formattedText"
      ]
    },
    "RefinementHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RefinementHistory",
      "type": "object",
      "description": "Represents a LinkedIn post format refinement by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RefinementHistory entity."
        },
        "postId": {
          "type": "string",
          "description": "Reference to the Post that was refined. (Relationship: Post 1:N RefinementHistory)"
        },
        "refinedText": {
          "type": "string",
          "description": "The AI-refined text of the post."
        },
        "formattingType": {
          "type": "string",
          "description": "Options used to format text"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "refinedText"
      ]
    }
  },
  "auth": {
    "providers": [
      "google"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/admins/{userId}",
        "definition": {
            "entityName": "Admin",
            "schema": { "$ref": "#/backend/entities/Admin" },
            "description": "Stores a list of admin user UIDs for secure rule checking."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership simplifies security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/user_metadata/{userId}",
        "definition": {
            "entityName": "UserMetadata",
            "schema": { "$ref": "#/backend/entities/UserMetadata" },
            "description": "Stores non-public user data like credit balance."
        }
      },
      {
          "path": "/user_metadata/{userId}/usage_history/{usageId}",
          "definition": {
              "entityName": "UsageHistory",
              "schema": { "$ref": "#/backend/entities/UsageHistory" },
              "description": "A log of each time a user spends a credit."
          }
      },
      {
        "path": "/users/{userId}/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores posts created by a specific user. Path-based ownership simplifies security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who owns the post."
            },
            {
              "name": "postId",
              "description": "The unique ID of the post."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/posts/{postId}/refinementHistory/{refinementHistoryId}",
        "definition": {
          "entityName": "RefinementHistory",
          "schema": {
            "$ref": "#/backend/entities/RefinementHistory"
          },
          "description": "Stores the history of AI formatting refinements for a specific post.  Path-based ownership simplifies security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who owns the post."
            },
            {
              "name": "postId",
              "description": "The unique ID of the post being refined."
            },
            {
              "name": "refinementHistoryId",
              "description": "The unique ID of the refinement history entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the LinkedIn Post Formatter AI application.  It leverages path-based ownership for user-generated content (Posts and RefinementHistory). Authorization independence is achieved by avoiding `get()` calls in security rules.  QAPs (rules are not filters) are supported by the segregation of user-owned data into predictable paths. This segregation ensures that `list` operations are secure and efficient because rules can easily validate the existence of a `userId` claim on all resources in the collection.\n\nSpecifically:\n\n*   **Admins**: A top-level `admins` collection stores admin UIDs. This is a secure and scalable way to manage permissions, as the `isAdmin()` function can do a simple `exists()` check.\n*   **Users**:  User profiles are stored in a collection `/users/{userId}` using path-based ownership.  This simplifies security rules since the user ID is directly available in the path.\n*   **UserMetadata**: Non-public user information like credit balance is stored in `/user_metadata/{userId}` for secure access.\n*   **UsageHistory**: A subcollection under user metadata to log credit spending.\n*   **Posts**: Posts are stored in `/users/{userId}/posts/{postId}`. This enforces that all posts are owned by a specific user and simplifies security rules.\n*   **RefinementHistory**: RefinementHistory documents are nested under Posts at `/users/{userId}/posts/{postId}/refinementHistory/{refinementHistoryId}`. This maintains the relationship and ownership from User to Post to RefinementHistory."
  }
}
